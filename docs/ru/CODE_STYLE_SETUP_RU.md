# Настройка автоматического форматирования кода

## Что настроено

### 1. IntelliJ IDEA Code Style
- **Файлы**: `.idea/codeStyles/Project.xml`, `.idea/codeStyles/codeStyleConfig.xml`
- **Настройки**: 120 символов в строке, автоматический перенос при вводе
- **Применение**: Автоматически при открытии проекта

### 2. Actions on Save
- **Файл**: `.idea/actionsOnSave.xml`
- **Действия**: Автоматическое форматирование, оптимизация импортов, перестановка кода
- **Применение**: При сохранении файлов (Ctrl+S / Cmd+S)

### 3. Checkstyle
- **Файл**: `backend/config/checkstyle/checkstyle.xml`
- **Назначение**: Проверка качества кода на соответствие стандартам кодирования.
- **Описание**: Этот файл содержит набор правил, которым должен соответствовать Java-код проекта.
- **Запуск**: `./gradlew checkstyleMain checkstyleTest`

### 4. PMD
- **Файл**: `backend/config/pmd/pmd.xml`
- **Назначение**: Статический анализ кода для выявления потенциальных ошибок, проблем производительности и дублирования кода.
- **Запуск**: `./gradlew pmdMain pmdTest`

## Как включить автоматическое форматирование

### В IntelliJ IDEA:

1. **Проверьте настройки проекта**:
   - `File → Settings → Editor → Code Style → Scheme = "Project"`
   - Должно быть установлено автоматически

2. **Включите Actions on Save** (если не работает автоматически):
   - `File → Settings → Tools → Actions on Save`
   - Включите:
     - ✅ Reformat code
     - ✅ Optimize imports  
     - ✅ Rearrange code (переупорядочивает члены класса, например, поля, конструкторы, методы в определенном порядке).
   - В поле "File path patterns": `**/*.java`

3. **Проверьте автоматический перенос строк**:
   - `File → Settings → Editor → Code Style → Java → Wrapping and Braces`
   - "Wrap on typing" должно быть включено

## Как использовать

### Автоматическое форматирование:
- **При сохранении**: Код автоматически форматируется при Ctrl+S (Cmd+S)
- **Вручную**: Ctrl+Alt+L (Cmd+Alt+L) для форматирования

### Проверка качества кода:
```bash
# Проверить основной код с помощью Checkstyle
./gradlew checkstyleMain

# Проверить тесты с помощью Checkstyle
./gradlew checkstyleTest

# Проверить основной код с помощью PMD
./gradlew pmdMain

# Проверить тесты с помощью PMD
./gradlew pmdTest

# Запустить все проверки качества кода (включая Checkstyle, PMD и другие)
./gradlew check
```
*   **Примечание**: Задача `check` в Gradle агрегирует все задачи проверки качества кода, такие как `checkstyle` и `pmd`, запуская их последовательно.

## Разделение ответственности

| Инструмент | Назначение | Когда работает |
|------------|------------|----------------|
| **IntelliJ IDEA** | Форматирование кода (длина строк, отступы, переносы) | При сохранении / Ctrl+Alt+L |
| **Checkstyle** | Проверка качества кода на соответствие стандартам кодирования | При сборке проекта / `./gradlew check` |
| **PMD** | Статический анализ кода для выявления потенциальных ошибок и проблем | При сборке проекта / `./gradlew check` |

## Что исправлено

1. ✅ **Убрано дублирование**: Checkstyle больше не проверяет длину строк (это делает IntelliJ)
2. ✅ **Автоматическое форматирование**: Настроено через `actionsOnSave.xml`
3. ✅ **Перенос при вводе**: Включен `WRAP_ON_TYPING` в настройках проекта
4. ✅ **Git tracking**: Все файлы настроек добавлены в репозиторий

## Устранение неполадок

### Если автоматическое форматирование не работает:
1. Перезапустите IntelliJ IDEA
2. Проверьте `File → Settings → Tools → Actions on Save`
3. Убедитесь, что схема кода = "Project"

### Если Checkstyle или PMD выдает много ошибок:
- Это нормально! Эти инструменты проверяют качество кода и потенциальные проблемы, а не только форматирование.
- Исправляйте ошибки постепенно или настройте более мягкие правила в их конфигурационных файлах (`checkstyle.xml`, `pmd.xml`).
