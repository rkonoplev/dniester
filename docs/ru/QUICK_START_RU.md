> [Вернуться к содержанию документации](./README.md)
>
> **[Руководство по ежедневному рабочему процессу](./DEVELOPER_GUIDE_RU.md)**: Детальное описание
> полноценного рабочего процесса для разработчиков, включая настройку IDE, тестирование и
> интеграцию с CI/CD.

> Для определения ключевых терминов и технологий, пожалуйста, обратитесь к **[Глоссарию](./GLOSSARY_RU.md)**.

# Краткое руководство по началу работы

## Содержание

- [Рекомендуемый быстрый старт (через Makefile)](#рекомендуемый-быстрый-старт-через-makefile)
- [Обзор архитектуры: Backend и Frontend](#обзор-архитектуры-backend-и-frontend)
- [Самые частые команды (шпаргалка)](#самые-частые-команды-шпаргалка)
- [Управление запущенным проектом](#управление-запущенным-проектом)
  - [Что происходит в терминале при запуске?](#что-происходит-в-терминале-при-запуске)
  - [Как выйти из терминала, не останавливая сервисы?](#как-выйти-из-терминала-не-останавливая-сервисы)
  - [Начало и завершение рабочего дня](#начало-и-завершение-рабочего-дня)
- [Как обновлять код в Docker?](#как-обновлять-код-в-docker)
- [Продвинутые сценарии сборки](#продвинутые-сценарии-сборки)
  - [Таблица-шпаргалка по командам `make`](#таблица-шпаргалка-по-командам-make)
  - [Что делает "жёсткий rebuild"?](#что-делает-жёсткий-rebuild)
- [Прямое управление проектом через Docker Compose (без Makefile)](#прямое-управление-проектом-через-docker-compose-без-makefile)
  - [Эквивалентность команд `make` и `docker compose`](#эквивалентность-команд-make-и-docker-compose)
  - [Запуск всего окружения](#запуск-всего-окружения)
  - [Проверка статуса](#проверка-статуса)
  - [Остановка всего окружения](#остановка-всего-окружения)
  - [Полный сброс окружения (с удалением данных)](#полный-сброс-окружения-с-удалением-данных)
- [Ручное управление и отладка Docker-контейнеров](#ручное-управление-и-отладка-docker-контейнеров)
  - [Запуск и остановка отдельных сервисов](#запуск-и-остановка-отдельных-сервисов)
  - [Пересборка и перезапуск одного сервиса](#пересборка-и-перезапуск-одного-сервиса)
  - [Сценарий отладки: "больной" `phoebe-app`](#сценарий-отладки-больной-phoebe-app)
- [Основные команды для разработки](#основные-команды-для-разработки)
  - [Запуск тестов](#запуск-тестов)
  - [Сборка проекта](#сборка-проекта)
  - [Проверка качества кода](#проверка-качества-кода)
- [Решение проблем](#решение-проблем)
  - [Тесты не запускаются (конфликт с MySQL)](#тесты-не-запускаются-конфликт-с-mysql)
  - [Сброс базы данных](#сброс-базы-данных)
  - [Проблемы с портами](#проблемы-с-портами)
- [Дополнительная документация](#дополнительная-документация)

Краткая инструкция для разработчиков для **ежедневной работы** с уже настроенным проектом.

> **Важно**: Для **первоначальной настройки** проекта, пожалуйста, следуйте подробному
> [Руководству по установке](./SETUP_GUIDE_RU.md).

---

## Рекомендуемый быстрый старт (через Makefile)

Весь основной рабочий процесс построен вокруг `Makefile` для простоты. Это самый простой способ начать.

- **Запуск проекта**: `make run`
- **Запуск всех тестов**: `make all-tests`
- **Остановка проекта**: `make stop`

> Для полного списка команд и описания их работы, обратитесь к
> **[Тестирование и разработка с Makefile](./TESTING_WITH_MAKEFILE_RU.md)**.

---

## Обзор архитектуры: Backend и Frontend

Когда вы запускаете проект, поднимаются два основных сервиса:

- **Backend** (`phoebe-app`, порт `8080`)
  - Это Spring Boot приложение, которое обрабатывает API, логику, базу данных и авторизацию.
  - Доступен по адресу: [http://localhost:8080/swagger-ui/index.html](http://localhost:8080/swagger-ui/index.html)

- **Frontend** (`phoebe-nextjs`, порт `3000`)
  - Это референсное фронтенд-приложение (например, на Next.js или Angular) — визуальный интерфейс,
    который обращается к backend через API.
  - Доступен по адресу: [http://localhost:3000](http://localhost:3000)
  - Учетные данные для входа (логины и пароли) для разных ролей описаны в файле
    **[DATABASE_GUIDE_RU.md](./DATABASE_GUIDE_RU.md)**.

---

## Самые частые команды (шпаргалка)

| Цель | Команда |
|:---|:---|
| Запустить проект утром | `make run` |
| Остановить вечером | `make stop` |
| Посмотреть логи бэкенда | `docker compose logs -f phoebe-app` |
| Полностью пересобрать с нуля | `make hard-rebuild` (или вручную) |
| Удалить всё, включая базу данных | `make reset` |

---

## Управление запущенным проектом

### Что происходит в терминале при запуске?
Когда вы запускаете команду, например:

```bash
make run
```
или
```bash
docker compose up
```
— Docker Compose запускает все контейнеры и “прицепляет” их логи прямо к вашему терминалу.
Вы увидите бегущие логи `phoebe-app`, `phoebe-mysql`, `phoebe-nextjs` и так далее.

Это нормально и полезно во время отладки — сразу видно, если что-то пошло не так.

### Как выйти из терминала, не останавливая сервисы?
Есть три варианта:

| Действие | Что делает | Команда |
|:---|:---|:---|
| Отключиться, но оставить всё работать | Контейнеры продолжают работу в фоновом режиме | Нажмите `Ctrl + p`, потом `Ctrl + q` |
| Остановить всё и выйти | Контейнеры выключаются | Нажмите `Ctrl + C` |
| Остановить Docker Compose принудительно | То же, что и выше, но гарантированно | Если терминал “завис”, наберите `make stop` в новом окне |

### Начало и завершение рабочего дня
- **Утром**: Убедитесь, что Docker Desktop (или Docker Engine) запущен.
  Перейдите в папку проекта и запустите проект:
  ```bash
  cd /путь/к/вашему/проекту
  make run
  ```
  или, если у вас уже была сборка — даже быстрее будет просто:
  ```bash
  docker compose up
  ```
  Всё поднимется в том же состоянии, база данных сохранится, так как volume `mysql_data` не удаляется.

- **Вечером**: Выполните `make stop`. Это корректно остановит контейнеры, сохранив данные.
- **Полный сброс**: Если хотите снести всё, включая базу данных, используйте `make reset`.

---

## Как обновлять код в Docker?

При работе с Docker важно понимать, как ваши изменения в коде попадают в контейнер.

- **Быстрое обновление (с кэшем)**: `make run`
  Эта команда использует `docker compose up --build`. Она быстро пересобирает только те части,
  которые изменились. Используйте ее в 99% случаев для ежедневной разработки.

- **Полная пересборка (без кэша)**: `make rebuild`
  Эта команда использует `docker compose build --no-cache`. Она полностью пересобирает образ с нуля.
  Используйте ее, только если вы изменили зависимости (`build.gradle`) или сам `Dockerfile`,
  или если проект ведет себя странно.

> Подробное объяснение всех команд и сценариев вы найдете в **[Руководстве по Docker](./DOCKER_GUIDE_RU.md)**.

---

## Продвинутые сценарии сборки

### Таблица-шпаргалка по командам `make`

| Цель | Когда использовать | Что делает |
|:---|:---|:---|
| `make run` | При обычной разработке, после правок в коде | Пересобирает и запускает проект, c кэшом |
| `make stop` | Чтобы остановить | Останавливает и сохраняет данные |
| `make rebuild` | После обновления Dockerfile, Gradle, зависимостей | Пересобирает без кэша, чтобы точно обновить |
| `make reset` | Когда хочешь всё снести и начать заново | Полный “reset” контейнеров и volume |
| `make boot` | Для отладки бэкенда локально без Docker | Запускает Spring Boot напрямую |
| `make test` / `make all-tests` | Прогонить тесты | Testcontainers / unit+integration |

### Что делает "жёсткий rebuild"?
Иногда простой `make rebuild` может не помочь. Для этого существует более радикальный метод,
который можно выполнить вручную:

```bash
docker compose down       # 1. Останавливает и очищает контейнеры
docker compose build --no-cache phoebe-app  # 2. Полностью пересобирает backend без кэша
docker compose up         # 3. Запускает с нуля
```

**Когда это реально нужно?**
Используйте этот метод, если вы:
- меняли `Dockerfile.dev`;
- меняли зависимости в `build.gradle`;
- меняли версию JDK, Gradle или плагинов;
- подозреваете, что Docker использует "грязный" кэш, и обычный `rebuild` не помогает.

**Когда это НЕ нужно?**
Если вы меняете только Java-код, `.yml`-конфиги или фронтенд, достаточно легкой команды `make run`.

---

## Прямое управление проектом через Docker Compose (без Makefile)

Для разработчиков, которые предпочитают или нуждаются в прямом использовании команд `docker compose`,
этот раздел предоставляет эквиваленты основным командам `make`.
Более подробную информацию о работе с Docker Compose можно найти в **[Руководстве по Docker](./DOCKER_GUIDE_RU.md)**.

### Эквивалентность команд `make` и `docker compose`

| Команда `make` | Эквивалент `docker compose` | Описание |
|:---------------|:-----------------------------|:---------|
| `make run`     | `docker compose up --build`  | Запускает все сервисы (БД, бэкенд, фронтенд), пересобирая образы с кэшем. |
| `make stop`    | `docker compose down`        | Останавливает все сервисы, сохраняя данные базы данных. |
| `make reset`   | `docker compose down -v`     | Останавливает все сервисы и полностью удаляет тома (включая данные БД). |

### Запуск всего окружения

Чтобы запустить все сервисы проекта (базу данных, бэкенд и фронтенд) без использования `Makefile`:

```bash
docker compose up --build
```
Эта команда соберет (используя кэш) и запустит все сервисы, определенные в `docker-compose.yml`.

### Проверка статуса

После запуска вы можете проверить состояние контейнеров и доступность сервисов:

-   **Проверить запущенные контейнеры**:
    ```bash
    docker ps
    ```
-   **API бэкенда**: [http://localhost:8080](http://localhost:8080)
-   **Swagger UI**: [http://localhost:8080/swagger-ui/index.html](http://localhost:8080/swagger-ui/index.html)
-   **Фронтенд**: [http://localhost:3000](http://localhost:3000)
-   **Учетные данные для входа в админку**: `admin` / `admin`

### Остановка всего окружения

Чтобы остановить все запущенные сервисы, сохраняя при этом данные базы данных:

```bash
docker compose down
```

### Полный сброс окружения (с удалением данных)

Если вы хотите полностью очистить все контейнеры, сети и **удалить данные базы данных** (например, чтобы начать с чистого листа):

```bash
docker compose down -v
```
**Внимание**: Эта команда безвозвратно удалит все данные из вашей базы данных.

---

## Ручное управление и отладка Docker-контейнеров

Хотя `Makefile` предоставляет удобные команды для большинства задач, иногда требуется более тонкий
контроль над отдельными Docker-сервисами. Это особенно актуально при отладке, когда нужно
перезапустить или пересобрать только один компонент, не затрагивая остальные.

### Запуск и остановка отдельных сервисов

Вы можете управлять каждым сервисом, определенным в `docker-compose.yml`, по отдельности:

-   **Запустить конкретный сервис (и его зависимости)**:
    ```bash
    docker compose up -d <имя_сервиса>
    ```
    Например, чтобы запустить только базу данных: `docker compose up -d phoebe-mysql`

-   **Остановить конкретный сервис**:
    ```bash
    docker compose stop <имя_сервиса>
    ```
    Например, чтобы остановить только бэкенд: `docker compose stop phoebe-app`

-   **Перезапустить конкретный сервис**:
    ```bash
    docker compose restart <имя_сервиса>
    ```
    Например: `docker compose restart phoebe-app`

### Пересборка и перезапуск одного сервиса

Если вы внесли изменения в код или Dockerfile конкретного сервиса и хотите его пересобрать,
не затрагивая другие, используйте следующую команду:

```bash
docker compose up --build -d <имя_сервиса>
```
Эта команда "умна": она пересоберет образ только для указанного сервиса (если были изменения),
перезапустит его и все сервисы, которые от него зависят, при этом не трогая другие уже запущенные
сервисы (например, базу данных).

### Сценарий отладки: "больной" `phoebe-app`

Представьте, что вы работаете над бэкендом, и после изменений `phoebe-app` перестал отвечать
или "упал", но `phoebe-mysql` и `phoebe-nextjs` продолжают работать.

1.  **Проверьте логи `phoebe-app`**:
    ```bash
    docker compose logs -f phoebe-app
    ```
    Это поможет понять причину сбоя.

2.  **Внесите исправления в код бэкенда**.

3.  **Пересоберите и перезапустите только `phoebe-app`**:
    ```bash
    docker compose up --build -d phoebe-app
    ```
    Эта команда:
    *   Пересоберет Docker-образ `phoebe-app` (используя кэш, если возможно, или без него,
        если вы изменили `Dockerfile.dev` или зависимости).
    *   Остановит старый контейнер `phoebe-app`.
    *   Запустит новый контейнер `phoebe-app`.
    *   Перезапустит `phoebe-nextjs`, так как он зависит от `phoebe-app`.
    *   **Не будет трогать `phoebe-mysql`**, если он уже запущен и здоров.

    Это значительно быстрее, чем полный `make hard-rebuild`, так как не останавливает и не
    пересобирает все компоненты.

---

## Основные команды для разработки

Все команды выполняются из директории `backend/`.

### Запуск тестов
```bash
./gradlew clean test
```

### Сборка проекта
```bash
./gradlew build
```

### Проверка качества кода
```bash
./gradlew checkstyleMain checkstyleTest
```

---

## Решение проблем

### Тесты не запускаются (конфликт с MySQL)
- Проверь, что в `application.yml` **нет** `spring.profiles.active: local`
- В `application-test.yml` должен быть отключён Flyway
- Запускай тесты с чистой сборкой: `./gradlew clean test`

### Сброс базы данных
```bash
docker compose down -v  # удалит все данные
docker compose up -d    # создаст чистую базу
```

### Проблемы с портами
- MySQL: порт 3306 (может конфликтовать с локальным MySQL)
- Spring Boot: порт 8080
- Останови локальные сервисы или измени порты в `.env.dev`

---

## Дополнительная документация

- **[Руководство по установке](./SETUP_GUIDE_RU.md)**: Пошаговая инструкция для первого запуска.
- **[Руководство разработчика](./DEVELOPER_GUIDE_RU.md)**: Детальная настройка IDE и описание
  рабочего процесса.
- **[Обзор проекта](./PROJECT_OVERVIEW_RU.md)**: Полная информация об архитектуре и технологиях.
- **[Миграция с Drupal 6 (RU)](MIGRATION_DRUPAL6_RU.md)**: Процесс миграции.
