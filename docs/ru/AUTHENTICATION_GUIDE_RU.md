# Руководство по аутентификации

> Для определения ключевых терминов и технологий, пожалуйста, обратитесь к **[Глоссарию](./GLOSSARY_RU.md)**.

Этот документ объясняет архитектуру аутентификации и практики безопасности в Phoebe CMS.

---

## Архитектура аутентификации

### Текущая реализация
- **Базовая аутентификация (Basic Authentication)** с использованием Spring Security.
- **Учетные данные на основе окружения** (без хранения в базе данных).
- **Управление доступом на основе ролей** (RBAC).
- **Кодирование паролей BCrypt**.
- **Интеграция с ограничением частоты запросов**.

### Принципы безопасности
- **Разделение ответственности**: Профили пользователей и учетные данные для аутентификации — это разные сущности.
- **Конфигурация через окружение**: Учетные данные передаются только через переменные окружения.
- **Отсутствие хранения учетных данных**: Данные для аутентификации никогда не сохраняются в базе данных.
- **Доступ на основе ролей**: Роли ADMIN и EDITOR с разными наборами разрешений.

---

## Роли пользователей и разрешения

| Роль | Разрешения | Эндпоинты |
|---|---|---|
| ADMIN | Полный доступ к системе, управление всем контентом. | `/api/admin/**` |
| EDITOR | Только собственный контент (создание, чтение, обновление). | `/api/admin/news/**` |

> **Примечание**: Детальные требования к реализации ролей описаны в
> [Руководстве по безопасности ролей](./SECURITY_ROLES_RU.md).

---

## Конфигурация

### Переменные окружения
```bash
# Учетные данные администратора
ADMIN_USERNAME=admin
ADMIN_PASSWORD=secureAdminPassword

# Учетные данные редактора (опционально)
EDITOR_USERNAME=editor
EDITOR_PASSWORD=secureEditorPassword
```

### Конфигурация безопасности
- **Кодирование паролей**: BCrypt с силой 12.
- **Аутентификация**: HTTP Basic Auth.
- **Управление сессиями**: Без состояния (stateless).
- **Защита от CSRF**: Отключена для API.

---

## Примеры использования

### Доступ администратора
```bash
# Получить все новости (эндпоинт администратора)
curl -u admin:secureAdminPassword \
  http://localhost:8080/api/admin/news
```

### Доступ редактора
```bash
# Редактор может просматривать все новости, но редактировать только свои
curl -u editor:secureEditorPassword \
  -H "Content-Type: application/json" \
  -d '{"title":"Моя статья","content":"Содержимое"}' \
  http://localhost:8080/api/admin/news
```

### Публичный доступ
```bash
# Аутентификация не требуется
curl http://localhost:8080/api/public/news?size=10
```

---

## Лучшие практики безопасности

### Разработка
- Используйте файл `.env` для локальных учетных данных (никогда не коммитьте его).
- Используйте сильные, уникальные пароли для каждой среды.

### Продакшен
- Устанавливайте учетные данные через переменные окружения или файлы секретов.
- Используйте менеджеры секретов в системах оркестрации контейнеров.
- Включайте HTTPS/TLS для защиты передачи учетных данных.

### CI/CD
- Храните учетные данные в секретах GitHub.
- Никогда не логируйте и не выводите учетные данные в логах сборки.

---

## Будущие улучшения

- **Миграция на OAuth 2.0 + 2FA**: Замена Basic Auth на OAuth 2.0 и двухфакторную аутентификацию.
- **JWT-токены** для аутентификации без состояния.
- **Аутентификация по API-ключу** для межсервисного взаимодействия.
- **Аудит-логирование** событий аутентификации.

---

## Соображения по безопасности

### Текущие ограничения
- Учетные данные Basic Auth передаются с каждым запросом.
- Отсутствует механизм истечения срока действия или обновления токенов.
- Ограниченный аудит событий аутентификации.
- Нет блокировки учетной записи или защиты от брутфорса.

### Стратегии смягчения рисков
- **Ограничение частоты запросов**: Предотвращает атаки методом перебора.
- **Принудительное использование HTTPS**: Защищает передачу учетных данных.
- **Изоляция окружений**: Раздельные учетные данные для каждой среды.
- **Мониторинг**: Логирование неудачных попыток аутентификации.
