# Руководство разработчика – Локальная работа и CI/CD

Этот файл описывает, как удобно работать над проектом на локальной машине (IntelliJ IDEA, Gradle, Docker)
и что будет автоматически выполняться в GitHub Actions (CI/CD).

---

## Первоначальная настройка проекта

Для первого запуска проекта существует два основных сценария:

1.  **Миграция из Drupal 6**: Этот путь использует базу данных MySQL.
2.  **Чистая установка**: Вы можете выбрать MySQL или PostgreSQL.

> Для получения подробных пошаговых инструкций по обоим сценариям, пожалуйста, обратитесь к
> **[Руководству по установке](./SETUP_GUIDE_RU.md)**.

## Ежедневный рабочий процесс

После того как проект настроен, вам не нужно постоянно держать Docker-контейнеры запущенными.
Сосредоточьтесь на написании кода и локальном запуске тестов.

### Основные действия в IDEA:
- **Сборка проекта**: `Build Project` (Ctrl+F9) для проверки компиляции.
- **Запуск юнит-тестов**:
    - Через IDEA, кликнув правой кнопкой мыши на классе/методе.
    - Или командой в терминале: `./gradlew test`
- **Проверка стиля кода** (опционально, помогает избежать ошибок в CI):
  ```bash
  ./gradlew checkstyleMain
  ```

### Запуск полного приложения (при необходимости)

1.  **Запустите Docker-окружение**:
    ```bash
    docker compose --env-file .env.dev up -d
    ```
2.  **Запустите приложение**:
    ```bash
    cd backend
    ./gradlew bootRun --args='--spring.profiles.active=local,mysql' # или postgresql
    ```

## Миграции базы данных (Flyway)

Проект использует Flyway для управления изменениями схемы БД. Для поддержки нескольких СУБД скрипты
организованы в отдельных директориях.

- `db/migration/common/`: Общие скрипты для всех СУБД.
- `db/migration/mysql/`: Скрипты только для MySQL.
- `db/migration/postgresql/`: Скрипты только для PostgreSQL.

Пути к миграциям настраиваются в `application-{profile}.yml` в зависимости от активного профиля Spring.

---

## Шпаргалка по командам Docker

- **Проверить запущенные контейнеры**:
  ```bash
  docker ps
  ```
- **Остановить все сервисы**:
  ```bash
  docker compose down
  ```
- **Удалить все данные (включая БД)**:
  ```bash
  docker compose down -v
  ```

---

## Шпаргалка по командам MySQL в контейнере

- **Подключиться к MySQL**:
  ```bash
  docker exec -it news-mysql mysql -uroot -proot
  ```
- **Сделать дамп базы данных**:
  ```bash
  docker exec -i news-mysql mysqldump -uroot -proot dniester > db_data/exported_dump.sql
  ```
- **Импортировать дамп**:
  ```bash
  docker exec -i news-mysql mysql -uroot -proot dniester < db_data/exported_dump.sql
  ```
