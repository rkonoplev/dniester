# Приложение: Восстановление исходной БД Drupal 6 из Docker-вольюма

Этот документ описывает, как создать резервную копию самой первой базы данных Drupal 6, если вы
подозреваете, что она была утеряна, или если стандартный процесс миграции создает пустой дамп.
Это может произойти, если Docker Compose создает новый пустой том вместо подключения существующего.

### Контекст проблемы

После миграции в системе Docker могут остаться несколько вольюмов (хранилищ данных). Наша задача —
найти "золотой" вольюм, содержащий исходные данные Drupal 6, и безопасно извлечь их.

### Шаг 1: Инвентаризация всех Docker-вольюмов

Сначала получим список всех вольюмов, чтобы понять, что у нас есть.

```bash
docker volume ls
```

Вы увидите список, похожий на этот:
```
DRIVER    VOLUME NAME
local     legacy_mysql_data_drupal6
local     news-platform_mysql_data
local     news-platform_mysql_data_drupal6
local     phoebe_mysql_data
```

- `phoebe_mysql_data`: Вольюм вашего текущего проекта (MySQL 8.0).
- `legacy_mysql_data_drupal6`: Скорее всего, новый пустой вольюм, созданный недавним запуском.
- `news-platform_mysql_data_drupal6`: **Наиболее вероятный кандидат** на "золотой" вольюм с исходными данными.

### Шаг 2: Поиск точного имени вольюма

Чтобы быть на 100% уверенным, какой вольюм был привязан к вашему самому старому контейнеру, выполните:

```bash
docker inspect news-mysql-drupal6
```

В выводе найдите секцию `Mounts`. Поле `Name` укажет на точное имя вольюма, который вам нужен.

### Шаг 3 (Опционально): Исследование вольюма

Чтобы убедиться, что в вольюме действительно есть данные, можно заглянуть внутрь с помощью временного
"контейнера-проводника". Замените `<имя_вольюма>` на имя, найденное на предыдущем шаге.

```bash
docker run --rm -it -v <имя_вольюма>:/data ubuntu:latest bash
```

Внутри контейнера выполните `cd /data` и `du -sh .`. Размер должен быть внушительным (например, >200MB).
После проверки выйдите из контейнера командой `exit`.

### Шаг 4: Создание дампа из правильного вольюма

Теперь, зная точное имя "золотого" вольюма, мы можем создать его полный дамп. Эта команда запускает
временный контейнер с MySQL 5.7, монтирует к нему ваш вольюм и выполняет `mysqldump`.

Замените `<имя_вольюма>` на ваше (например, `news-platform_mysql_data_drupal6`).

```bash
docker run --rm -v <имя_вольюма>:/var/lib/mysql -v $(pwd):/backup mysql:5.7 \
sh -c 'mysqld --daemonize && sleep 30 && mysqldump -uroot -proot --all-databases > /backup/drupal6_migration_backup_FULL.sql'
```

- `mysqld --daemonize`: Запускает сервер MySQL в фоновом режиме внутри контейнера.
- `sleep 30`: Пауза в 30 секунд, чтобы дать серверу время полностью запуститься.
- `mysqldump ...`: Создает дамп всех баз данных и сохраняет его в файл `drupal6_migration_backup_FULL.sql`
  в вашей текущей директории на хост-машине.

После выполнения этой команды у вас будет полный и корректный бэкап вашей самой первой базы данных.
