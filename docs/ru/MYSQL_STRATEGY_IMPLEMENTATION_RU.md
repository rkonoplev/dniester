> [Вернуться к содержанию документации](./README.md)

# ADR: Сводка реализации стратегии MySQL-only

## Завершено: Полное удаление H2

### 1. Стратегия базы данных "продакшн-первый"
- Реализовано: Подход только MySQL во всех средах
- Удалено: Зависимость H2 полностью из проекта
- Преимущество: 100% консистентность продакшена в тестировании

### 2. Унифицированная стратегия Testcontainers (версия 1.19.7)
- Реализовано: MySQL Testcontainers везде (локально и CI)
- Настроено: BaseIntegrationTest с автоматическим MySQL контейнером
- Удалено: Зависимость Docker Compose из CI
- Преимущество: Идентичные тестовые среды на всех платформах

### 3. Улучшенная архитектура тестов
- Разделено: Unit тесты (только моки) от интеграционных тестов (реальная БД)
- Настроено: Gradle sourceSets для правильной изоляции тестов
- Обновлено: Все тестовые конфигурации для использования MySQL

### 4. Очистка конфигурации базы данных
- Стандартизировано: Имя базы данных как `phoebe_db` во всех средах
- Удалено: Дублирующие и устаревшие конфигурационные файлы
- Упрощено: Структура тестовых ресурсов

## Обновленные файлы

1. **`backend/build.gradle`**
   - Удалены зависимости H2 полностью
   - Обновлен плагин Spring dependency management
   - Добавлен JUnit Platform Launcher
   - Настроено правильное разделение sourceSets

2. **Конфигурации тестов**
   - `application-test.yml`: MySQL с Flyway для unit тестов
   - `application-integration-test.yml`: MySQL с Testcontainers
   - Удалены дублирующие файлы: `application-ci.yml`, `application-local.yml`, `application.yml`

3. **`BaseIntegrationTest.java`**
   - Унифицированный контейнер Testcontainers MySQL для всех сред
   - Динамическая конфигурация datasource
   - Правильная изоляция тестов со стратегией create-drop

4. **Документация**
   - Обновлены все ссылки с H2 на MySQL-only
   - Исправлено имя базы данных на `phoebe_db`
   - Удалена устаревшая информация CI/CD

## Достигнутые преимущества

- Консистентность продакшена: Все среды используют идентичную технологию базы данных
- Надежность тестов: Интеграционные тесты выполняются против реальных экземпляров MySQL
- Упрощенная архитектура: Нет сложности абстракции базы данных
- Стабильность CI/CD: Консистентное поведение в локальной, CI и продакшн средах
- Уверенность разработчика: Тесты валидируют реальные продакшн сценарии

## Текущий статус

Проект теперь следует унифицированной стратегии Testcontainers:
- Unit тесты: Быстрое выполнение с моками
- Интеграционные тесты: Реальный MySQL через Testcontainers везде
- Локальная разработка: Testcontainers MySQL для интеграционных тестов (Docker требуется для запуска Testcontainers, но ручное управление Docker Compose для тестовой БД не требуется)
- CI/CD: Testcontainers MySQL (упрощенный пайплайн)
- Продакшн: Та же технология базы данных, что и во всех тестовых средах