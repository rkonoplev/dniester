# CI/CD Guide

This document describes the continuous integration (CI) pipeline used in the project.

> For information on local testing and development, see [Testing and Development with Makefile](./TESTING_WITH_MAKEFILE.md).

---

## Pipeline Overview (GitHub Actions)

The CI/CD process is built on **GitHub Actions** and defined in the `.github/workflows/gradle-ci.yml` file. It runs on every `push` or `pull request` to the `main`, `master`, and `develop` branches.

### Main Pipeline Stages

1.  **Setup Environment**
    - Installs **Java 21 (Temurin)**.
    - Enables **Docker**, which is required for Testcontainers.

2.  **Build and Test**
    - A single command is executed to build the project and run all types of tests (unit and integration):
      ```bash
      ./gradlew clean build integrationTest jacocoTestReport --no-daemon
      ```
    - **`clean`**: Cleans up previous build artifacts.
    - **`build`**: Compiles the code and runs unit tests (via the `test` task dependency).
    - **`integrationTest`**: Runs integration tests using **Testcontainers**, which spins up a temporary MySQL instance in Docker.
    - **`jacocoTestReport`**: Generates a code coverage report.

3.  **Code Coverage Analysis**
    - On successful test completion, the coverage report generated by JaCoCo is uploaded to **Codecov**.
    - This allows tracking coverage trends and analyzing them directly in Pull Requests.

---

## Tools and Code Quality

Code quality is enforced at multiple levels, integrated into the Gradle build:

- **Testcontainers**: Ensures that integration tests run in a production-like environment (MySQL), both locally and in CI.
- **JaCoCo**: Measures code coverage by tests.
- **Codecov**: Provides visualization for coverage reports.
- **Checkstyle & PMD**: Static analysis tools that enforce code style and detect potential issues. They are automatically run during the `build` task.

---

## Security

- **Secret Management**: The CI pipeline uses **GitHub Actions Secrets** to securely store credentials. Locally, a `.env` file is used, which is excluded from Git.
- **Secret Scanning**: Although GitLeaks is no longer part of the automated CI pipeline, it is recommended to use it locally before pushing changes to prevent accidental leaks of keys and passwords.
  ```bash
  gitleaks detect --source .
  ```

---

## Summary

- The CI pipeline is fully automated and unified.
- The command executed in CI is equivalent to running `make all-tests` locally.
- Testcontainers ensures reliable and isolated testing in a production-like environment.
- Code quality and security are monitored at every stage.