# Архив SQL-скриптов процесса миграции

**ВНИМАНИЕ:** Файлы в этой директории являются историческим архивом. Они **не используются** в текущей работе проекта и сохранены исключительно для документирования одноразового процесса миграции с Drupal 6 на новую схему данных.

Текущий проект использует автоматические миграции **Flyway**, которые находятся в `backend/src/main/resources/db/migration/common`.

[English Version](./README.md)

---

### Роль этих скриптов в процессе миграции

Процесс миграции был построен по принципу ETL (Extract, Transform, Load). Эти скрипты выполняли этап **Transform**, преобразуя "сырые" данные из дампа Drupal 6 в чистую, структурированную схему для нового приложения.

---

### Описание файлов

#### Основные скрипты трансформации

- **`migrate_from_drupal6_universal.sql`**
  - **Статус в Git:** ✅ Отслеживается. 
  - **Назначение:** Главный, основной скрипт миграции. Он создавал новые таблицы (`users`, `roles`, `content`, `terms` и др.) и переносил в них данные из старых таблиц Drupal, очищая и нормализуя их. Это было ядро всего процесса.

- **`update_migrated_users.sql`**
  - **Статус в Git:** ✅ Отслеживается.
  - **Назначение:** Скрипт пост-обработки пользователей. Он запускался *после* основного скрипта и устанавливал временный пароль (`changeme123`), генерировал временные email и т.д.

#### Скрипты для кастомных полей (CCK)

- **`detect_custom_fields.sql`**
  - **Статус в Git:** ✅ Отслеживается.
  - **Назначение:** Диагностический скрипт. Проверял, использовались ли на старом сайте Drupal кастомные поля (модуль CCK).

- **`migrate_cck_fields.sql`**
  - **Статус в Git:** ✅ Отслеживается.
  - **Назначение:** Опциональный скрипт. Если кастомные поля были найдены, этот скрипт переносил их значения в новую таблицу `custom_fields`.

#### Вспомогательные и финальные файлы

- **`create_admin_user.sql`**
  - **Статус в Git:** ✅ Отслеживается.
  - **Назначение:** Вспомогательный скрипт для быстрой локальной разработки. Его функциональность теперь покрывается автоматической миграцией Flyway.

- **`clean_schema.sql`**
  - **Статус в Git:** ❌ **Не отслеживается** и добавлен в `.gitignore`.
  - **Причина:** Большой размер. Это финальный дамп базы данных *после* применения всех трансформаций. Его содержимое послужило основой для автоматических миграций Flyway.

- **`drupal6_fixed.sql`**
  - **Статус в Git:** ❌ **Не отслеживается** и добавлен в `.gitignore`.
  - **Причина:** Большой размер. Это была промежуточная копия оригинального дампа Drupal, использовавшаяся для трансформаций.
